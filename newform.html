<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inscripción — Curso de Griego Koiné</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root { --gold: #d9a441; --dark-blue: #0b2545; }
    body {
      margin:0; font-family:'Roboto', sans-serif;
      background:linear-gradient(rgba(11,37,69,0.6),rgba(11,37,69,0.6)),
        url("https://images.unsplash.com/photo-1509023464722-18d996393ca8?q=80&w=1600&auto=format&fit=crop") center/cover no-repeat;
      display:flex; align-items:center; justify-content:center; min-height:100vh; padding:20px;
    }
    .form-card { background:#fff; padding:30px; border-radius:14px; max-width:680px; width:100%; box-shadow:0 10px 40px rgba(0,0,0,.25); }
    h1 { font-family:'Playfair Display',serif; margin:0 0 20px; text-align:center; color:var(--dark-blue); }
    label { display:block; margin-bottom:14px; font-weight:500; }
    input, select, textarea {
      width:100%; padding:12px; border-radius:8px; border:1px solid #ccc; font-size:1rem; margin-top:6px;
    }
    textarea { resize:vertical; }
    .actions { text-align:center; margin-top:20px; }
    button {
      background:linear-gradient(180deg,var(--gold),#b8862e); border:0; color:var(--dark-blue);
      font-weight:700; padding:12px 20px; border-radius:10px; cursor:pointer; font-size:1rem;
      transition:transform .15s ease;
    }
    button:hover { transform:translateY(-2px); }
    .note { font-size:.9rem; color:#555; margin-top:16px; text-align:center; }
    .success-message {
      display:none; margin-top:20px; padding:16px; background:#e6f7ea;
      border:1px solid #b4e1c1; border-radius:10px; color:#205723; text-align:center;
    }
    .loading { position:relative; }
    .loading::after {
      content:"";
      position:absolute;
      right:-25px;
      top:50%;
      transform:translateY(-50%);
      width:16px;
      height:16px;
      border:3px solid rgba(255,255,255,0.3);
      border-top-color:var(--dark-blue);
      border-radius:50%;
      animation:spin 1s linear infinite;
    }
    @keyframes spin { to { transform:translateY(-50%) rotate(360deg); } }
  </style>
</head>
<body>
  <div class="form-card">
    <h1>Formulario de inscripción</h1>
    <form id="inscriptionForm">
      <label>Nombre completo
        <input type="text" name="nombre" required placeholder="Ej: Rolando Desdín">
      </label>
      <label>Correo electrónico
        <input type="email" name="email" required placeholder="tucorreo@ejemplo.com">
      </label>
      <label>Teléfono / WhatsApp
        <input type="text" name="telefono" placeholder="+53 555 555 555">
      </label>
      <label>Rol
        <select name="rol" required>
          <option value="">Seleccione...</option>
          <option>Estudiante</option>
          <option>Líder</option>
          <option>Pastor</option>
          <option>Otro</option>
        </select>
      </label>
      <label>Mensaje
        <textarea name="mensaje" rows="4" placeholder="Cuéntanos brevemente tu motivación..."></textarea>
      </label>
      <div class="actions"><button type="submit" id="submitBtn">Enviar inscripción</button></div>
      <p class="note">Al enviar este formulario, aceptas ser contactado con información sobre el curso.</p>
    </form>
    <div class="success-message" id="successMessage">✅ ¡Gracias! Tu inscripción fue enviada con éxito.</div>
  </div>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  
  <script>
    // Inicializar EmailJS con tu USER_ID
    (function() {
      emailjs.init('kr8cihUL5uK-1tPGH'); // Reemplaza con tu USER_ID real de EmailJS
    })();
    
    const form = document.getElementById("inscriptionForm");
    const successMsg = document.getElementById("successMessage");
    const submitBtn = document.getElementById("submitBtn");

    form.addEventListener("submit", async function(e) {
      e.preventDefault();
      
      // Validación adicional
      if (!form.nombre.value || !form.email.value) {
        alert("Por favor complete los campos requeridos");
        return;
      }
      
      // 1. Preparar los datos
      const data = {
        nombre: form.nombre.value,
        email: form.email.value,
        telefono: form.telefono.value,
        rol: form.rol.value,
        mensaje: form.mensaje.value,
        fecha: new Date().toLocaleString('es-ES')
      };
      
      // 2. Mostrar estado de carga
      submitBtn.classList.add("loading");
      submitBtn.disabled = true;
      
      try {
        // 3. Enviar a Google Sheets
        const sheetsResponse = await fetch("https://script.google.com/macros/s/AKfycbw_sYtxQ0kZbW1uvf2aH5BOSHhwB17VuSFc8u_we0CSpevAEkgD_ETIR6j4otndjR8Z/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
          mode: "no-cors" // Importante para evitar problemas CORS
        });
        
        // 4. Enviar email con EmailJS
        const emailResponse = await emailjs.send(
          "service_fimbksu",       // SERVICE_ID de EmailJS
          "template_yhpfjbw",      // TEMPLATE_ID de EmailJS
          {
            to_name: "Administrador",
            from_name: data.nombre,
            from_email: data.email,
            message: `Nueva inscripción:\n\nNombre: ${data.nombre}\nEmail: ${data.email}\nTeléfono: ${data.telefono}\nRol: ${data.rol}\nMensaje: ${data.mensaje}`
          }
        );
        
        // 5. Mostrar éxito
        form.reset();
        successMsg.style.display = "block";
        successMsg.scrollIntoView({ behavior: 'smooth' });
        
        // Opcional: Redirigir después de éxito
        // setTimeout(() => { window.location.href = "gracias.html"; }, 2000);
        
      } catch (error) {
        console.error("Error completo:", error);
        alert("Hubo un problema al enviar el formulario. Por favor intente nuevamente más tarde.");
      } finally {
        // Restaurar botón
        submitBtn.classList.remove("loading");
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>